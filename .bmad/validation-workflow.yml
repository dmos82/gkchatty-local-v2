# Builder Pro Validation Workflow Configuration
# Enforces proper testing loop before marking MVP complete

workflow:
  name: "BMAD Builder Pro Validation Loop"
  version: "1.0.0"
  description: "Automated validation with iterative testing and fixing"

phases:

  phase_1_implementation:
    name: "Implementation Complete"
    status: "required"
    validation:
      - typescript_compiles: true
      - dev_server_runs: true
      - no_runtime_errors: true
    output: "Build created with no errors"

  phase_2_comprehensive_playwright_testing:
    name: "Comprehensive Playwright Testing"
    status: "required"
    description: "Test EVERY button, link, form, and user flow"

    test_requirements:
      screenshots:
        - homepage
        - auth_pages (login, signup)
        - main_app_pages (feed, post creation, profile)
        - detail_pages (post detail, user profile)
        - search_results

      button_testing:
        - click_all_navigation_buttons
        - click_all_action_buttons (create, submit, cancel)
        - click_all_vote_buttons
        - click_all_dropdown_items
        - verify_redirects_work

      link_testing:
        - click_all_internal_links
        - verify_profile_links
        - verify_post_links
        - verify_comment_links

      form_testing:
        - test_validation_errors (too short, invalid format)
        - test_successful_submission
        - test_loading_states
        - test_error_messages

      user_flows:
        - complete_signup_flow
        - complete_login_flow
        - create_post_flow
        - vote_on_post_flow
        - comment_on_post_flow
        - search_flow
        - logout_flow

      console_monitoring:
        - check_for_errors_on_every_page
        - check_for_errors_during_every_interaction
        - log_all_warnings

    output:
      - screenshots_captured: "docs/screenshots/*.png"
      - bugs_documented: "docs/validation/bugs-found.md"
      - test_report: "docs/validation/playwright-test-report.md"

  phase_3_orchestrate_build:
    name: "Run Builder Pro Orchestration"
    status: "required"
    tool: "mcp__builder-pro-mcp__orchestrate_build"

    parameters:
      projectPath: "{project_root}"
      config:
        frontend:
          url: "http://localhost:3000"
        backend:
          url: null # if applicable
      autoFix: true
      maxIterations: 3
      stopOnCritical: false

    phases_executed:
      - phase_1: "Detect missing dependencies"
      - phase_2: "Run visual smoke test (Playwright)"
      - phase_3: "Validate config file consistency"
      - phase_4: "Scan busy ports and allocate"
      - phase_5: "Categorize bugs + auto-fix"

    output:
      - validation_report: "generated by tool"
      - bugs_categorized:
          - critical: []
          - high: []
          - medium: []
          - low: []
      - auto_fixes_applied: []

  phase_4_manual_fixes:
    name: "Apply Manual Fixes"
    status: "required"
    description: "Fix issues that couldn't be auto-fixed"

    tasks:
      - review_orchestration_report
      - fix_critical_bugs
      - fix_high_priority_bugs
      - address_medium_issues (if time permits)
      - commit_fixes

    output:
      - fixes_applied: "list of changes made"

  phase_5_rerun_playwright_tests:
    name: "Re-run Comprehensive Playwright Tests"
    status: "required"
    description: "Full test suite again to verify fixes and catch regressions"

    test_requirements:
      - run_all_tests_from_phase_2: true
      - compare_with_previous_run: true
      - verify_bugs_fixed: true
      - check_for_new_regressions: true

    output:
      - new_test_report: "docs/validation/playwright-retest-report.md"
      - comparison: "bugs_fixed vs new_bugs_found"

  phase_6_evaluation:
    name: "Evaluate Test Results"
    status: "required"

    decision_tree:
      all_tests_pass:
        action: "proceed_to_phase_7"
        criteria:
          - no_critical_bugs: true
          - no_high_bugs: true
          - console_errors: 0
          - all_buttons_work: true
          - all_links_work: true
          - all_forms_work: true

      issues_found:
        action: "loop_back_to_phase_3"
        criteria:
          - bugs_found: true
          - iteration_count: "< 3"

        max_iterations_reached:
          action: "document_remaining_issues"
          then: "proceed_to_phase_7_with_warnings"

  phase_7_present_to_user:
    name: "Present for Human Smoke Test"
    status: "required"

    presentation:
      - show_test_results: true
      - show_screenshots: true
      - show_validation_report: true
      - highlight_any_remaining_issues: true
      - request_human_smoke_test: true

    user_actions:
      - manually_test_application
      - verify_core_functionality
      - approve_or_request_changes

validation_loop:
  max_iterations: 3
  iteration_steps:
    - step_3: "orchestrate_build"
    - step_4: "manual_fixes"
    - step_5: "rerun_playwright_tests"
    - step_6: "evaluate_results"

  exit_conditions:
    success:
      - all_tests_pass: true
      - no_critical_bugs: true
      - no_high_bugs: true

    max_iterations:
      - iterations_completed: 3
      - document_remaining_issues: true
      - require_user_decision: true

enforcement:
  cannot_mark_complete_without:
    - phase_2_completed: true
    - phase_3_completed: true
    - phase_5_completed: true
    - phase_7_user_approval: true

  required_documentation:
    - playwright_test_report
    - orchestration_report
    - bugs_found_and_fixed
    - screenshots_directory
    - final_validation_summary

automation_triggers:
  after_phase_1_complete:
    action: "prompt_user_to_run_phase_2"
    message: "Implementation complete. Run comprehensive Playwright tests?"

  after_phase_2_complete:
    action: "auto_run_phase_3"
    tool: "orchestrate_build"

  after_phase_4_complete:
    action: "auto_run_phase_5"
    message: "Re-running full Playwright test suite..."

  after_phase_6_issues_found:
    action: "loop_back_to_phase_3"
    max_loops: 3
